"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["node_modules_langchain_dist_chat_models_openai_js"],{

/***/ "./node_modules/langchain/dist/chat_models/base.js":
/*!*********************************************************!*\
  !*** ./node_modules/langchain/dist/chat_models/base.js ***!
  \*********************************************************/
/***/ (function(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"BaseChatModel\": function() { return /* binding */ BaseChatModel; },\n/* harmony export */   \"SimpleChatModel\": function() { return /* binding */ SimpleChatModel; }\n/* harmony export */ });\n/* harmony import */ var _schema_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../schema/index.js */ \"./node_modules/langchain/dist/schema/index.js\");\n/* harmony import */ var _base_language_index_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../base_language/index.js */ \"./node_modules/langchain/dist/base_language/index.js\");\n/* harmony import */ var _callbacks_manager_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../callbacks/manager.js */ \"./node_modules/langchain/dist/callbacks/manager.js\");\n\n\n\nclass BaseChatModel extends _base_language_index_js__WEBPACK_IMPORTED_MODULE_1__.BaseLanguageModel {\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"lc_namespace\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: [\"langchain\", \"chat_models\", this._llmType()]\n        });\n    }\n    async generate(messages, options, callbacks) {\n        const generations = [];\n        const llmOutputs = [];\n        let parsedOptions;\n        if (Array.isArray(options)) {\n            parsedOptions = { stop: options };\n        }\n        else if (options?.timeout && !options.signal) {\n            parsedOptions = {\n                ...options,\n                signal: AbortSignal.timeout(options.timeout),\n            };\n        }\n        else {\n            parsedOptions = options ?? {};\n        }\n        const callbackManager_ = await _callbacks_manager_js__WEBPACK_IMPORTED_MODULE_2__.CallbackManager.configure(callbacks, this.callbacks, parsedOptions.tags, this.tags, { verbose: this.verbose });\n        const extra = {\n            options: parsedOptions,\n            invocation_params: this?.invocationParams(),\n        };\n        const runManager = await callbackManager_?.handleChatModelStart(this.toJSON(), messages, undefined, undefined, extra);\n        try {\n            const results = await Promise.all(messages.map((messageList) => this._generate(messageList, parsedOptions, runManager)));\n            for (const result of results) {\n                if (result.llmOutput) {\n                    llmOutputs.push(result.llmOutput);\n                }\n                generations.push(result.generations);\n            }\n        }\n        catch (err) {\n            await runManager?.handleLLMError(err);\n            throw err;\n        }\n        const output = {\n            generations,\n            llmOutput: llmOutputs.length\n                ? this._combineLLMOutput?.(...llmOutputs)\n                : undefined,\n        };\n        await runManager?.handleLLMEnd(output);\n        Object.defineProperty(output, _schema_index_js__WEBPACK_IMPORTED_MODULE_0__.RUN_KEY, {\n            value: runManager ? { runId: runManager?.runId } : undefined,\n            configurable: true,\n        });\n        return output;\n    }\n    /**\n     * Get the parameters used to invoke the model\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    invocationParams() {\n        return {};\n    }\n    _modelType() {\n        return \"base_chat_model\";\n    }\n    async generatePrompt(promptValues, options, callbacks) {\n        const promptMessages = promptValues.map((promptValue) => promptValue.toChatMessages());\n        return this.generate(promptMessages, options, callbacks);\n    }\n    async call(messages, options, callbacks) {\n        const result = await this.generate([messages], options, callbacks);\n        const generations = result.generations;\n        return generations[0][0].message;\n    }\n    async callPrompt(promptValue, options, callbacks) {\n        const promptMessages = promptValue.toChatMessages();\n        return this.call(promptMessages, options, callbacks);\n    }\n    async predictMessages(messages, options, callbacks) {\n        return this.call(messages, options, callbacks);\n    }\n    async predict(text, options, callbacks) {\n        const message = new _schema_index_js__WEBPACK_IMPORTED_MODULE_0__.HumanChatMessage(text);\n        const result = await this.call([message], options, callbacks);\n        return result.text;\n    }\n}\nclass SimpleChatModel extends BaseChatModel {\n    async _generate(messages, options, runManager) {\n        const text = await this._call(messages, options, runManager);\n        const message = new _schema_index_js__WEBPACK_IMPORTED_MODULE_0__.AIChatMessage(text);\n        return {\n            generations: [\n                {\n                    text: message.text,\n                    message,\n                },\n            ],\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbGFuZ2NoYWluL2Rpc3QvY2hhdF9tb2RlbHMvYmFzZS5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUErRTtBQUNoQjtBQUNKO0FBQ3BELDRCQUE0QixzRUFBaUI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLDRFQUF5Qiw2REFBNkQsdUJBQXVCO0FBQ3BKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLHFEQUFPO0FBQzdDLGtDQUFrQywyQkFBMkI7QUFDN0Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0Qiw4REFBZ0I7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQSw0QkFBNEIsMkRBQWE7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9ub2RlX21vZHVsZXMvbGFuZ2NoYWluL2Rpc3QvY2hhdF9tb2RlbHMvYmFzZS5qcz8zZDA2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFJQ2hhdE1lc3NhZ2UsIEh1bWFuQ2hhdE1lc3NhZ2UsIFJVTl9LRVksIH0gZnJvbSBcIi4uL3NjaGVtYS9pbmRleC5qc1wiO1xuaW1wb3J0IHsgQmFzZUxhbmd1YWdlTW9kZWwsIH0gZnJvbSBcIi4uL2Jhc2VfbGFuZ3VhZ2UvaW5kZXguanNcIjtcbmltcG9ydCB7IENhbGxiYWNrTWFuYWdlciwgfSBmcm9tIFwiLi4vY2FsbGJhY2tzL21hbmFnZXIuanNcIjtcbmV4cG9ydCBjbGFzcyBCYXNlQ2hhdE1vZGVsIGV4dGVuZHMgQmFzZUxhbmd1YWdlTW9kZWwge1xuICAgIGNvbnN0cnVjdG9yKGZpZWxkcykge1xuICAgICAgICBzdXBlcihmaWVsZHMpO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJsY19uYW1lc3BhY2VcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFtcImxhbmdjaGFpblwiLCBcImNoYXRfbW9kZWxzXCIsIHRoaXMuX2xsbVR5cGUoKV1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIGdlbmVyYXRlKG1lc3NhZ2VzLCBvcHRpb25zLCBjYWxsYmFja3MpIHtcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvbnMgPSBbXTtcbiAgICAgICAgY29uc3QgbGxtT3V0cHV0cyA9IFtdO1xuICAgICAgICBsZXQgcGFyc2VkT3B0aW9ucztcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9ucykpIHtcbiAgICAgICAgICAgIHBhcnNlZE9wdGlvbnMgPSB7IHN0b3A6IG9wdGlvbnMgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvcHRpb25zPy50aW1lb3V0ICYmICFvcHRpb25zLnNpZ25hbCkge1xuICAgICAgICAgICAgcGFyc2VkT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgICAgIHNpZ25hbDogQWJvcnRTaWduYWwudGltZW91dChvcHRpb25zLnRpbWVvdXQpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHBhcnNlZE9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrTWFuYWdlcl8gPSBhd2FpdCBDYWxsYmFja01hbmFnZXIuY29uZmlndXJlKGNhbGxiYWNrcywgdGhpcy5jYWxsYmFja3MsIHBhcnNlZE9wdGlvbnMudGFncywgdGhpcy50YWdzLCB7IHZlcmJvc2U6IHRoaXMudmVyYm9zZSB9KTtcbiAgICAgICAgY29uc3QgZXh0cmEgPSB7XG4gICAgICAgICAgICBvcHRpb25zOiBwYXJzZWRPcHRpb25zLFxuICAgICAgICAgICAgaW52b2NhdGlvbl9wYXJhbXM6IHRoaXM/Lmludm9jYXRpb25QYXJhbXMoKSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcnVuTWFuYWdlciA9IGF3YWl0IGNhbGxiYWNrTWFuYWdlcl8/LmhhbmRsZUNoYXRNb2RlbFN0YXJ0KHRoaXMudG9KU09OKCksIG1lc3NhZ2VzLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZXh0cmEpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKG1lc3NhZ2VzLm1hcCgobWVzc2FnZUxpc3QpID0+IHRoaXMuX2dlbmVyYXRlKG1lc3NhZ2VMaXN0LCBwYXJzZWRPcHRpb25zLCBydW5NYW5hZ2VyKSkpO1xuICAgICAgICAgICAgZm9yIChjb25zdCByZXN1bHQgb2YgcmVzdWx0cykge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGxtT3V0cHV0KSB7XG4gICAgICAgICAgICAgICAgICAgIGxsbU91dHB1dHMucHVzaChyZXN1bHQubGxtT3V0cHV0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZ2VuZXJhdGlvbnMucHVzaChyZXN1bHQuZ2VuZXJhdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGF3YWl0IHJ1bk1hbmFnZXI/LmhhbmRsZUxMTUVycm9yKGVycik7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3V0cHV0ID0ge1xuICAgICAgICAgICAgZ2VuZXJhdGlvbnMsXG4gICAgICAgICAgICBsbG1PdXRwdXQ6IGxsbU91dHB1dHMubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyB0aGlzLl9jb21iaW5lTExNT3V0cHV0Py4oLi4ubGxtT3V0cHV0cylcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgfTtcbiAgICAgICAgYXdhaXQgcnVuTWFuYWdlcj8uaGFuZGxlTExNRW5kKG91dHB1dCk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvdXRwdXQsIFJVTl9LRVksIHtcbiAgICAgICAgICAgIHZhbHVlOiBydW5NYW5hZ2VyID8geyBydW5JZDogcnVuTWFuYWdlcj8ucnVuSWQgfSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgcGFyYW1ldGVycyB1c2VkIHRvIGludm9rZSB0aGUgbW9kZWxcbiAgICAgKi9cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGludm9jYXRpb25QYXJhbXMoKSB7XG4gICAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgX21vZGVsVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiYmFzZV9jaGF0X21vZGVsXCI7XG4gICAgfVxuICAgIGFzeW5jIGdlbmVyYXRlUHJvbXB0KHByb21wdFZhbHVlcywgb3B0aW9ucywgY2FsbGJhY2tzKSB7XG4gICAgICAgIGNvbnN0IHByb21wdE1lc3NhZ2VzID0gcHJvbXB0VmFsdWVzLm1hcCgocHJvbXB0VmFsdWUpID0+IHByb21wdFZhbHVlLnRvQ2hhdE1lc3NhZ2VzKCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZShwcm9tcHRNZXNzYWdlcywgb3B0aW9ucywgY2FsbGJhY2tzKTtcbiAgICB9XG4gICAgYXN5bmMgY2FsbChtZXNzYWdlcywgb3B0aW9ucywgY2FsbGJhY2tzKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuZ2VuZXJhdGUoW21lc3NhZ2VzXSwgb3B0aW9ucywgY2FsbGJhY2tzKTtcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvbnMgPSByZXN1bHQuZ2VuZXJhdGlvbnM7XG4gICAgICAgIHJldHVybiBnZW5lcmF0aW9uc1swXVswXS5tZXNzYWdlO1xuICAgIH1cbiAgICBhc3luYyBjYWxsUHJvbXB0KHByb21wdFZhbHVlLCBvcHRpb25zLCBjYWxsYmFja3MpIHtcbiAgICAgICAgY29uc3QgcHJvbXB0TWVzc2FnZXMgPSBwcm9tcHRWYWx1ZS50b0NoYXRNZXNzYWdlcygpO1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsKHByb21wdE1lc3NhZ2VzLCBvcHRpb25zLCBjYWxsYmFja3MpO1xuICAgIH1cbiAgICBhc3luYyBwcmVkaWN0TWVzc2FnZXMobWVzc2FnZXMsIG9wdGlvbnMsIGNhbGxiYWNrcykge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsKG1lc3NhZ2VzLCBvcHRpb25zLCBjYWxsYmFja3MpO1xuICAgIH1cbiAgICBhc3luYyBwcmVkaWN0KHRleHQsIG9wdGlvbnMsIGNhbGxiYWNrcykge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gbmV3IEh1bWFuQ2hhdE1lc3NhZ2UodGV4dCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbChbbWVzc2FnZV0sIG9wdGlvbnMsIGNhbGxiYWNrcyk7XG4gICAgICAgIHJldHVybiByZXN1bHQudGV4dDtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgU2ltcGxlQ2hhdE1vZGVsIGV4dGVuZHMgQmFzZUNoYXRNb2RlbCB7XG4gICAgYXN5bmMgX2dlbmVyYXRlKG1lc3NhZ2VzLCBvcHRpb25zLCBydW5NYW5hZ2VyKSB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCB0aGlzLl9jYWxsKG1lc3NhZ2VzLCBvcHRpb25zLCBydW5NYW5hZ2VyKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IG5ldyBBSUNoYXRNZXNzYWdlKHRleHQpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2VuZXJhdGlvbnM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IG1lc3NhZ2UudGV4dCxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgfTtcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/langchain/dist/chat_models/base.js\n"));

/***/ }),

/***/ "./node_modules/langchain/dist/chat_models/openai.js":
/*!***********************************************************!*\
  !*** ./node_modules/langchain/dist/chat_models/openai.js ***!
  \***********************************************************/
/***/ (function(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ChatOpenAI\": function() { return /* binding */ ChatOpenAI; },\n/* harmony export */   \"PromptLayerChatOpenAI\": function() { return /* binding */ PromptLayerChatOpenAI; }\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"./node_modules/openai/dist/index.js\");\n/* harmony import */ var _util_env_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/env.js */ \"./node_modules/langchain/dist/util/env.js\");\n/* harmony import */ var _util_axios_fetch_adapter_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../util/axios-fetch-adapter.js */ \"./node_modules/langchain/dist/util/axios-fetch-adapter.js\");\n/* harmony import */ var _base_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./base.js */ \"./node_modules/langchain/dist/chat_models/base.js\");\n/* harmony import */ var _schema_index_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../schema/index.js */ \"./node_modules/langchain/dist/schema/index.js\");\n/* harmony import */ var _base_language_count_tokens_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../base_language/count_tokens.js */ \"./node_modules/langchain/dist/base_language/count_tokens.js\");\n/* harmony import */ var _util_prompt_layer_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../util/prompt-layer.js */ \"./node_modules/langchain/dist/util/prompt-layer.js\");\n/* harmony import */ var _tools_convert_to_openai_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../tools/convert_to_openai.js */ \"./node_modules/langchain/dist/tools/convert_to_openai.js\");\n/* provided dependency */ var process = __webpack_require__(/*! process */ \"./node_modules/next/dist/build/polyfills/process.js\");\n\n\n\n\n\n\n\n\nfunction messageTypeToOpenAIRole(type) {\n    switch (type) {\n        case \"system\":\n            return \"system\";\n        case \"ai\":\n            return \"assistant\";\n        case \"human\":\n            return \"user\";\n        case \"function\":\n            return \"function\";\n        default:\n            throw new Error(`Unknown message type: ${type}`);\n    }\n}\nfunction openAIResponseToChatMessage(message) {\n    switch (message.role) {\n        case \"user\":\n            return new _schema_index_js__WEBPACK_IMPORTED_MODULE_4__.HumanChatMessage(message.content || \"\");\n        case \"assistant\":\n            return new _schema_index_js__WEBPACK_IMPORTED_MODULE_4__.AIChatMessage(message.content || \"\", {\n                function_call: message.function_call,\n            });\n        case \"system\":\n            return new _schema_index_js__WEBPACK_IMPORTED_MODULE_4__.SystemChatMessage(message.content || \"\");\n        default:\n            return new _schema_index_js__WEBPACK_IMPORTED_MODULE_4__.ChatMessage(message.content || \"\", message.role ?? \"unknown\");\n    }\n}\n/**\n * Wrapper around OpenAI large language models that use the Chat endpoint.\n *\n * To use you should have the `openai` package installed, with the\n * `OPENAI_API_KEY` environment variable set.\n *\n * To use with Azure you should have the `openai` package installed, with the\n * `AZURE_OPENAI_API_KEY`,\n * `AZURE_OPENAI_API_INSTANCE_NAME`,\n * `AZURE_OPENAI_API_DEPLOYMENT_NAME`\n * and `AZURE_OPENAI_API_VERSION` environment variable set.\n *\n * @remarks\n * Any parameters that are valid to be passed to {@link\n * https://platform.openai.com/docs/api-reference/chat/create |\n * `openai.createCompletion`} can be passed through {@link modelKwargs}, even\n * if not explicitly available on this class.\n */\nclass ChatOpenAI extends _base_js__WEBPACK_IMPORTED_MODULE_3__.BaseChatModel {\n    get callKeys() {\n        return [\"stop\", \"signal\", \"timeout\", \"options\", \"functions\", \"tools\"];\n    }\n    get lc_secrets() {\n        return {\n            openAIApiKey: \"OPENAI_API_KEY\",\n            azureOpenAIApiKey: \"AZURE_OPENAI_API_KEY\",\n        };\n    }\n    get lc_aliases() {\n        return {\n            modelName: \"model\",\n            openAIApiKey: \"openai_api_key\",\n            azureOpenAIApiVersion: \"azure_openai_api_version\",\n            azureOpenAIApiKey: \"azure_openai_api_key\",\n            azureOpenAIApiInstanceName: \"azure_openai_api_instance_name\",\n            azureOpenAIApiDeploymentName: \"azure_openai_api_deployment_name\",\n        };\n    }\n    constructor(fields, \n    /** @deprecated */\n    configuration) {\n        super(fields ?? {});\n        Object.defineProperty(this, \"lc_serializable\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: true\n        });\n        Object.defineProperty(this, \"temperature\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 1\n        });\n        Object.defineProperty(this, \"topP\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 1\n        });\n        Object.defineProperty(this, \"frequencyPenalty\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 0\n        });\n        Object.defineProperty(this, \"presencePenalty\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 0\n        });\n        Object.defineProperty(this, \"n\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 1\n        });\n        Object.defineProperty(this, \"logitBias\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"modelName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"gpt-3.5-turbo\"\n        });\n        Object.defineProperty(this, \"modelKwargs\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"stop\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"timeout\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"streaming\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"maxTokens\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIApiVersion\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIApiKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIApiInstanceName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"azureOpenAIApiDeploymentName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"client\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"clientConfig\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        const apiKey = fields?.openAIApiKey ?? (0,_util_env_js__WEBPACK_IMPORTED_MODULE_1__.getEnvironmentVariable)(\"OPENAI_API_KEY\");\n        const azureApiKey = fields?.azureOpenAIApiKey ??\n            (0,_util_env_js__WEBPACK_IMPORTED_MODULE_1__.getEnvironmentVariable)(\"AZURE_OPENAI_API_KEY\");\n        if (!azureApiKey && !apiKey) {\n            throw new Error(\"(Azure) OpenAI API key not found\");\n        }\n        const azureApiInstanceName = fields?.azureOpenAIApiInstanceName ??\n            (0,_util_env_js__WEBPACK_IMPORTED_MODULE_1__.getEnvironmentVariable)(\"AZURE_OPENAI_API_INSTANCE_NAME\");\n        const azureApiDeploymentName = fields?.azureOpenAIApiDeploymentName ??\n            (0,_util_env_js__WEBPACK_IMPORTED_MODULE_1__.getEnvironmentVariable)(\"AZURE_OPENAI_API_DEPLOYMENT_NAME\");\n        const azureApiVersion = fields?.azureOpenAIApiVersion ??\n            (0,_util_env_js__WEBPACK_IMPORTED_MODULE_1__.getEnvironmentVariable)(\"AZURE_OPENAI_API_VERSION\");\n        this.modelName = fields?.modelName ?? this.modelName;\n        this.modelKwargs = fields?.modelKwargs ?? {};\n        this.timeout = fields?.timeout;\n        this.temperature = fields?.temperature ?? this.temperature;\n        this.topP = fields?.topP ?? this.topP;\n        this.frequencyPenalty = fields?.frequencyPenalty ?? this.frequencyPenalty;\n        this.presencePenalty = fields?.presencePenalty ?? this.presencePenalty;\n        this.maxTokens = fields?.maxTokens;\n        this.n = fields?.n ?? this.n;\n        this.logitBias = fields?.logitBias;\n        this.stop = fields?.stop;\n        this.streaming = fields?.streaming ?? false;\n        this.azureOpenAIApiVersion = azureApiVersion;\n        this.azureOpenAIApiKey = azureApiKey;\n        this.azureOpenAIApiInstanceName = azureApiInstanceName;\n        this.azureOpenAIApiDeploymentName = azureApiDeploymentName;\n        if (this.streaming && this.n > 1) {\n            throw new Error(\"Cannot stream results when n > 1\");\n        }\n        if (this.azureOpenAIApiKey) {\n            if (!this.azureOpenAIApiInstanceName) {\n                throw new Error(\"Azure OpenAI API instance name not found\");\n            }\n            if (!this.azureOpenAIApiDeploymentName) {\n                throw new Error(\"Azure OpenAI API deployment name not found\");\n            }\n            if (!this.azureOpenAIApiVersion) {\n                throw new Error(\"Azure OpenAI API version not found\");\n            }\n        }\n        this.clientConfig = {\n            apiKey,\n            ...configuration,\n            ...fields?.configuration,\n        };\n    }\n    /**\n     * Get the parameters used to invoke the model\n     */\n    invocationParams() {\n        return {\n            model: this.modelName,\n            temperature: this.temperature,\n            top_p: this.topP,\n            frequency_penalty: this.frequencyPenalty,\n            presence_penalty: this.presencePenalty,\n            max_tokens: this.maxTokens === -1 ? undefined : this.maxTokens,\n            n: this.n,\n            logit_bias: this.logitBias,\n            stop: this.stop,\n            stream: this.streaming,\n            ...this.modelKwargs,\n        };\n    }\n    /** @ignore */\n    _identifyingParams() {\n        return {\n            model_name: this.modelName,\n            ...this.invocationParams(),\n            ...this.clientConfig,\n        };\n    }\n    /**\n     * Get the identifying parameters for the model\n     */\n    identifyingParams() {\n        return this._identifyingParams();\n    }\n    /** @ignore */\n    async _generate(messages, options, runManager) {\n        const tokenUsage = {};\n        if (this.stop && options?.stop) {\n            throw new Error(\"Stop found in input and default params\");\n        }\n        const params = this.invocationParams();\n        params.stop = options?.stop ?? params.stop;\n        params.functions =\n            options?.functions ??\n                (options?.tools ? options?.tools.map(_tools_convert_to_openai_js__WEBPACK_IMPORTED_MODULE_7__.formatToOpenAIFunction) : undefined);\n        params.function_call = options?.function_call;\n        const messagesMapped = messages.map((message) => ({\n            role: messageTypeToOpenAIRole(message._getType()),\n            content: message.text,\n            name: message.name,\n        }));\n        const data = params.stream\n            ? await new Promise((resolve, reject) => {\n                let response;\n                let rejected = false;\n                let resolved = false;\n                this.completionWithRetry({\n                    ...params,\n                    messages: messagesMapped,\n                }, {\n                    signal: options?.signal,\n                    ...options?.options,\n                    adapter: _util_axios_fetch_adapter_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"],\n                    responseType: \"stream\",\n                    onmessage: (event) => {\n                        if (event.data?.trim?.() === \"[DONE]\") {\n                            if (resolved) {\n                                return;\n                            }\n                            resolved = true;\n                            resolve(response);\n                        }\n                        else {\n                            const message = JSON.parse(event.data);\n                            // on the first message set the response properties\n                            if (!response) {\n                                response = {\n                                    id: message.id,\n                                    object: message.object,\n                                    created: message.created,\n                                    model: message.model,\n                                    choices: [],\n                                };\n                            }\n                            // on all messages, update choice\n                            for (const part of message.choices) {\n                                if (part != null) {\n                                    let choice = response.choices.find((c) => c.index === part.index);\n                                    if (!choice) {\n                                        choice = {\n                                            index: part.index,\n                                            finish_reason: part.finish_reason ?? undefined,\n                                        };\n                                        response.choices[part.index] = choice;\n                                    }\n                                    if (!choice.message) {\n                                        choice.message = {\n                                            role: part.delta\n                                                ?.role,\n                                            content: \"\",\n                                        };\n                                    }\n                                    if (part.delta.function_call &&\n                                        !choice.message.function_call) {\n                                        choice.message.function_call = {\n                                            name: \"\",\n                                            arguments: \"\",\n                                        };\n                                    }\n                                    choice.message.content += part.delta?.content ?? \"\";\n                                    if (choice.message.function_call) {\n                                        choice.message.function_call.name +=\n                                            part.delta?.function_call?.name ?? \"\";\n                                        choice.message.function_call.arguments +=\n                                            part.delta?.function_call?.arguments ?? \"\";\n                                    }\n                                    // TODO this should pass part.index to the callback\n                                    // when that's supported there\n                                    // eslint-disable-next-line no-void\n                                    void runManager?.handleLLMNewToken(part.delta?.content ?? \"\");\n                                    // TODO we don't currently have a callback method for\n                                    // sending the function call arguments\n                                }\n                            }\n                            // when all messages are finished, resolve\n                            if (!resolved &&\n                                message.choices.every((c) => c.finish_reason != null)) {\n                                resolved = true;\n                                resolve(response);\n                            }\n                        }\n                    },\n                }).catch((error) => {\n                    if (!rejected) {\n                        rejected = true;\n                        reject(error);\n                    }\n                });\n            })\n            : await this.completionWithRetry({\n                ...params,\n                messages: messagesMapped,\n            }, {\n                signal: options?.signal,\n                ...options?.options,\n            });\n        const { completion_tokens: completionTokens, prompt_tokens: promptTokens, total_tokens: totalTokens, } = data.usage ?? {};\n        if (completionTokens) {\n            tokenUsage.completionTokens =\n                (tokenUsage.completionTokens ?? 0) + completionTokens;\n        }\n        if (promptTokens) {\n            tokenUsage.promptTokens = (tokenUsage.promptTokens ?? 0) + promptTokens;\n        }\n        if (totalTokens) {\n            tokenUsage.totalTokens = (tokenUsage.totalTokens ?? 0) + totalTokens;\n        }\n        const generations = [];\n        for (const part of data.choices) {\n            const text = part.message?.content ?? \"\";\n            generations.push({\n                text,\n                message: openAIResponseToChatMessage(part.message ?? { role: \"assistant\" }),\n            });\n        }\n        return {\n            generations,\n            llmOutput: { tokenUsage },\n        };\n    }\n    async getNumTokensFromMessages(messages) {\n        let totalCount = 0;\n        let tokensPerMessage = 0;\n        let tokensPerName = 0;\n        // From: https://github.com/openai/openai-cookbook/blob/main/examples/How_to_format_inputs_to_ChatGPT_models.ipynb\n        if ((0,_base_language_count_tokens_js__WEBPACK_IMPORTED_MODULE_5__.getModelNameForTiktoken)(this.modelName) === \"gpt-3.5-turbo\") {\n            tokensPerMessage = 4;\n            tokensPerName = -1;\n        }\n        else if ((0,_base_language_count_tokens_js__WEBPACK_IMPORTED_MODULE_5__.getModelNameForTiktoken)(this.modelName).startsWith(\"gpt-4\")) {\n            tokensPerMessage = 3;\n            tokensPerName = 1;\n        }\n        const countPerMessage = await Promise.all(messages.map(async (message) => {\n            const textCount = await this.getNumTokens(message.text);\n            const roleCount = await this.getNumTokens(messageTypeToOpenAIRole(message._getType()));\n            const nameCount = message.name !== undefined\n                ? tokensPerName + (await this.getNumTokens(message.name))\n                : 0;\n            const count = textCount + tokensPerMessage + roleCount + nameCount;\n            totalCount += count;\n            return count;\n        }));\n        totalCount += 3; // every reply is primed with <|start|>assistant<|message|>\n        return { totalCount, countPerMessage };\n    }\n    /** @ignore */\n    async completionWithRetry(request, options) {\n        if (!this.client) {\n            const endpoint = this.azureOpenAIApiKey\n                ? `https://${this.azureOpenAIApiInstanceName}.openai.azure.com/openai/deployments/${this.azureOpenAIApiDeploymentName}`\n                : this.clientConfig.basePath;\n            const clientConfig = new openai__WEBPACK_IMPORTED_MODULE_0__.Configuration({\n                ...this.clientConfig,\n                basePath: endpoint,\n                baseOptions: {\n                    timeout: this.timeout,\n                    ...this.clientConfig.baseOptions,\n                },\n            });\n            this.client = new openai__WEBPACK_IMPORTED_MODULE_0__.OpenAIApi(clientConfig);\n        }\n        const axiosOptions = {\n            adapter: (0,_util_env_js__WEBPACK_IMPORTED_MODULE_1__.isNode)() ? undefined : _util_axios_fetch_adapter_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"],\n            ...this.clientConfig.baseOptions,\n            ...options,\n        };\n        if (this.azureOpenAIApiKey) {\n            axiosOptions.headers = {\n                \"api-key\": this.azureOpenAIApiKey,\n                ...axiosOptions.headers,\n            };\n            axiosOptions.params = {\n                \"api-version\": this.azureOpenAIApiVersion,\n                ...axiosOptions.params,\n            };\n        }\n        return this.caller\n            .call(this.client.createChatCompletion.bind(this.client), request, axiosOptions)\n            .then((res) => res.data);\n    }\n    _llmType() {\n        return \"openai\";\n    }\n    /** @ignore */\n    _combineLLMOutput(...llmOutputs) {\n        return llmOutputs.reduce((acc, llmOutput) => {\n            if (llmOutput && llmOutput.tokenUsage) {\n                acc.tokenUsage.completionTokens +=\n                    llmOutput.tokenUsage.completionTokens ?? 0;\n                acc.tokenUsage.promptTokens += llmOutput.tokenUsage.promptTokens ?? 0;\n                acc.tokenUsage.totalTokens += llmOutput.tokenUsage.totalTokens ?? 0;\n            }\n            return acc;\n        }, {\n            tokenUsage: {\n                completionTokens: 0,\n                promptTokens: 0,\n                totalTokens: 0,\n            },\n        });\n    }\n}\nclass PromptLayerChatOpenAI extends ChatOpenAI {\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"promptLayerApiKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"plTags\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"returnPromptLayerId\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.promptLayerApiKey =\n            fields?.promptLayerApiKey ??\n                (typeof process !== \"undefined\"\n                    ? // eslint-disable-next-line no-process-env\n                        process.env?.PROMPTLAYER_API_KEY\n                    : undefined);\n        this.plTags = fields?.plTags ?? [];\n        this.returnPromptLayerId = fields?.returnPromptLayerId ?? false;\n    }\n    async _generate(messages, options, runManager) {\n        const requestStartTime = Date.now();\n        let parsedOptions;\n        if (Array.isArray(options)) {\n            parsedOptions = { stop: options };\n        }\n        else if (options?.timeout && !options.signal) {\n            parsedOptions = {\n                ...options,\n                signal: AbortSignal.timeout(options.timeout),\n            };\n        }\n        else {\n            parsedOptions = options ?? {};\n        }\n        const generatedResponses = await super._generate(messages, parsedOptions, runManager);\n        const requestEndTime = Date.now();\n        const _convertMessageToDict = (message) => {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            let messageDict;\n            if (message._getType() === \"human\") {\n                messageDict = { role: \"user\", content: message.text };\n            }\n            else if (message._getType() === \"ai\") {\n                messageDict = { role: \"assistant\", content: message.text };\n            }\n            else if (message._getType() === \"system\") {\n                messageDict = { role: \"system\", content: message.text };\n            }\n            else if (message._getType() === \"generic\") {\n                messageDict = {\n                    role: message.role,\n                    content: message.text,\n                };\n            }\n            else {\n                throw new Error(`Got unknown type ${message}`);\n            }\n            return messageDict;\n        };\n        const _createMessageDicts = (messages, callOptions) => {\n            const params = {\n                ...this.invocationParams(),\n                model: this.modelName,\n            };\n            if (callOptions?.stop) {\n                if (Object.keys(params).includes(\"stop\")) {\n                    throw new Error(\"`stop` found in both the input and default params.\");\n                }\n            }\n            const messageDicts = messages.map((message) => _convertMessageToDict(message));\n            return messageDicts;\n        };\n        for (let i = 0; i < generatedResponses.generations.length; i += 1) {\n            const generation = generatedResponses.generations[i];\n            const messageDicts = _createMessageDicts(messages, parsedOptions);\n            let promptLayerRequestId;\n            const parsedResp = [\n                {\n                    content: generation.text,\n                    role: messageTypeToOpenAIRole(generation.message._getType()),\n                },\n            ];\n            const promptLayerRespBody = await (0,_util_prompt_layer_js__WEBPACK_IMPORTED_MODULE_6__.promptLayerTrackRequest)(this.caller, \"langchain.PromptLayerChatOpenAI\", messageDicts, this._identifyingParams(), this.plTags, parsedResp, requestStartTime, requestEndTime, this.promptLayerApiKey);\n            if (this.returnPromptLayerId === true) {\n                if (promptLayerRespBody.success === true) {\n                    promptLayerRequestId = promptLayerRespBody.request_id;\n                }\n                if (!generation.generationInfo ||\n                    typeof generation.generationInfo !== \"object\") {\n                    generation.generationInfo = {};\n                }\n                generation.generationInfo.promptLayerRequestId = promptLayerRequestId;\n            }\n        }\n        return generatedResponses;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbGFuZ2NoYWluL2Rpc3QvY2hhdF9tb2RlbHMvb3BlbmFpLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQW1EO0FBQ2E7QUFDTjtBQUNoQjtBQUM0RDtBQUMzQjtBQUNUO0FBQ0s7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCxLQUFLO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsOERBQWdCO0FBQ3ZDO0FBQ0EsdUJBQXVCLDJEQUFhO0FBQ3BDO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsdUJBQXVCLCtEQUFpQjtBQUN4QztBQUNBLHVCQUF1Qix5REFBVztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQ7QUFDQSw4QkFBOEIsdUJBQXVCLGtCQUFrQjtBQUN2RTtBQUNBO0FBQ08seUJBQXlCLG1EQUFhO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsK0NBQStDLG9FQUFzQjtBQUNyRTtBQUNBLFlBQVksb0VBQXNCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxvRUFBc0I7QUFDbEM7QUFDQSxZQUFZLG9FQUFzQjtBQUNsQztBQUNBLFlBQVksb0VBQXNCO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCwrRUFBc0I7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSw2QkFBNkIsb0VBQVk7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQixpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiLGdCQUFnQiwrRkFBK0Y7QUFDL0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUVBQXVFLG1CQUFtQjtBQUMxRixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLFlBQVk7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLHVGQUF1QjtBQUNuQztBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsdUZBQXVCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCx5QkFBeUI7QUFDekIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsZ0NBQWdDLHVDQUF1QyxrQ0FBa0M7QUFDdEk7QUFDQSxxQ0FBcUMsaURBQWE7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2IsOEJBQThCLDZDQUFTO0FBQ3ZDO0FBQ0E7QUFDQSxxQkFBcUIsb0RBQU0saUJBQWlCLG9FQUFZO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSx3QkFBd0IsT0FBTztBQUMvQjtBQUNBLHdCQUF3QixPQUFPO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLGdDQUFnQztBQUNoQztBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvREFBb0QsUUFBUTtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwyQ0FBMkM7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw4Q0FBOEMsOEVBQXVCO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vbm9kZV9tb2R1bGVzL2xhbmdjaGFpbi9kaXN0L2NoYXRfbW9kZWxzL29wZW5haS5qcz9kM2E0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbmZpZ3VyYXRpb24sIE9wZW5BSUFwaSwgfSBmcm9tIFwib3BlbmFpXCI7XG5pbXBvcnQgeyBnZXRFbnZpcm9ubWVudFZhcmlhYmxlLCBpc05vZGUgfSBmcm9tIFwiLi4vdXRpbC9lbnYuanNcIjtcbmltcG9ydCBmZXRjaEFkYXB0ZXIgZnJvbSBcIi4uL3V0aWwvYXhpb3MtZmV0Y2gtYWRhcHRlci5qc1wiO1xuaW1wb3J0IHsgQmFzZUNoYXRNb2RlbCB9IGZyb20gXCIuL2Jhc2UuanNcIjtcbmltcG9ydCB7IEFJQ2hhdE1lc3NhZ2UsIENoYXRNZXNzYWdlLCBIdW1hbkNoYXRNZXNzYWdlLCBTeXN0ZW1DaGF0TWVzc2FnZSwgfSBmcm9tIFwiLi4vc2NoZW1hL2luZGV4LmpzXCI7XG5pbXBvcnQgeyBnZXRNb2RlbE5hbWVGb3JUaWt0b2tlbiB9IGZyb20gXCIuLi9iYXNlX2xhbmd1YWdlL2NvdW50X3Rva2Vucy5qc1wiO1xuaW1wb3J0IHsgcHJvbXB0TGF5ZXJUcmFja1JlcXVlc3QgfSBmcm9tIFwiLi4vdXRpbC9wcm9tcHQtbGF5ZXIuanNcIjtcbmltcG9ydCB7IGZvcm1hdFRvT3BlbkFJRnVuY3Rpb24gfSBmcm9tIFwiLi4vdG9vbHMvY29udmVydF90b19vcGVuYWkuanNcIjtcbmZ1bmN0aW9uIG1lc3NhZ2VUeXBlVG9PcGVuQUlSb2xlKHR5cGUpIHtcbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSBcInN5c3RlbVwiOlxuICAgICAgICAgICAgcmV0dXJuIFwic3lzdGVtXCI7XG4gICAgICAgIGNhc2UgXCJhaVwiOlxuICAgICAgICAgICAgcmV0dXJuIFwiYXNzaXN0YW50XCI7XG4gICAgICAgIGNhc2UgXCJodW1hblwiOlxuICAgICAgICAgICAgcmV0dXJuIFwidXNlclwiO1xuICAgICAgICBjYXNlIFwiZnVuY3Rpb25cIjpcbiAgICAgICAgICAgIHJldHVybiBcImZ1bmN0aW9uXCI7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gbWVzc2FnZSB0eXBlOiAke3R5cGV9YCk7XG4gICAgfVxufVxuZnVuY3Rpb24gb3BlbkFJUmVzcG9uc2VUb0NoYXRNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgICBzd2l0Y2ggKG1lc3NhZ2Uucm9sZSkge1xuICAgICAgICBjYXNlIFwidXNlclwiOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBIdW1hbkNoYXRNZXNzYWdlKG1lc3NhZ2UuY29udGVudCB8fCBcIlwiKTtcbiAgICAgICAgY2FzZSBcImFzc2lzdGFudFwiOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBSUNoYXRNZXNzYWdlKG1lc3NhZ2UuY29udGVudCB8fCBcIlwiLCB7XG4gICAgICAgICAgICAgICAgZnVuY3Rpb25fY2FsbDogbWVzc2FnZS5mdW5jdGlvbl9jYWxsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIGNhc2UgXCJzeXN0ZW1cIjpcbiAgICAgICAgICAgIHJldHVybiBuZXcgU3lzdGVtQ2hhdE1lc3NhZ2UobWVzc2FnZS5jb250ZW50IHx8IFwiXCIpO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGF0TWVzc2FnZShtZXNzYWdlLmNvbnRlbnQgfHwgXCJcIiwgbWVzc2FnZS5yb2xlID8/IFwidW5rbm93blwiKTtcbiAgICB9XG59XG4vKipcbiAqIFdyYXBwZXIgYXJvdW5kIE9wZW5BSSBsYXJnZSBsYW5ndWFnZSBtb2RlbHMgdGhhdCB1c2UgdGhlIENoYXQgZW5kcG9pbnQuXG4gKlxuICogVG8gdXNlIHlvdSBzaG91bGQgaGF2ZSB0aGUgYG9wZW5haWAgcGFja2FnZSBpbnN0YWxsZWQsIHdpdGggdGhlXG4gKiBgT1BFTkFJX0FQSV9LRVlgIGVudmlyb25tZW50IHZhcmlhYmxlIHNldC5cbiAqXG4gKiBUbyB1c2Ugd2l0aCBBenVyZSB5b3Ugc2hvdWxkIGhhdmUgdGhlIGBvcGVuYWlgIHBhY2thZ2UgaW5zdGFsbGVkLCB3aXRoIHRoZVxuICogYEFaVVJFX09QRU5BSV9BUElfS0VZYCxcbiAqIGBBWlVSRV9PUEVOQUlfQVBJX0lOU1RBTkNFX05BTUVgLFxuICogYEFaVVJFX09QRU5BSV9BUElfREVQTE9ZTUVOVF9OQU1FYFxuICogYW5kIGBBWlVSRV9PUEVOQUlfQVBJX1ZFUlNJT05gIGVudmlyb25tZW50IHZhcmlhYmxlIHNldC5cbiAqXG4gKiBAcmVtYXJrc1xuICogQW55IHBhcmFtZXRlcnMgdGhhdCBhcmUgdmFsaWQgdG8gYmUgcGFzc2VkIHRvIHtAbGlua1xuICogaHR0cHM6Ly9wbGF0Zm9ybS5vcGVuYWkuY29tL2RvY3MvYXBpLXJlZmVyZW5jZS9jaGF0L2NyZWF0ZSB8XG4gKiBgb3BlbmFpLmNyZWF0ZUNvbXBsZXRpb25gfSBjYW4gYmUgcGFzc2VkIHRocm91Z2gge0BsaW5rIG1vZGVsS3dhcmdzfSwgZXZlblxuICogaWYgbm90IGV4cGxpY2l0bHkgYXZhaWxhYmxlIG9uIHRoaXMgY2xhc3MuXG4gKi9cbmV4cG9ydCBjbGFzcyBDaGF0T3BlbkFJIGV4dGVuZHMgQmFzZUNoYXRNb2RlbCB7XG4gICAgZ2V0IGNhbGxLZXlzKCkge1xuICAgICAgICByZXR1cm4gW1wic3RvcFwiLCBcInNpZ25hbFwiLCBcInRpbWVvdXRcIiwgXCJvcHRpb25zXCIsIFwiZnVuY3Rpb25zXCIsIFwidG9vbHNcIl07XG4gICAgfVxuICAgIGdldCBsY19zZWNyZXRzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgb3BlbkFJQXBpS2V5OiBcIk9QRU5BSV9BUElfS0VZXCIsXG4gICAgICAgICAgICBhenVyZU9wZW5BSUFwaUtleTogXCJBWlVSRV9PUEVOQUlfQVBJX0tFWVwiLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBnZXQgbGNfYWxpYXNlcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG1vZGVsTmFtZTogXCJtb2RlbFwiLFxuICAgICAgICAgICAgb3BlbkFJQXBpS2V5OiBcIm9wZW5haV9hcGlfa2V5XCIsXG4gICAgICAgICAgICBhenVyZU9wZW5BSUFwaVZlcnNpb246IFwiYXp1cmVfb3BlbmFpX2FwaV92ZXJzaW9uXCIsXG4gICAgICAgICAgICBhenVyZU9wZW5BSUFwaUtleTogXCJhenVyZV9vcGVuYWlfYXBpX2tleVwiLFxuICAgICAgICAgICAgYXp1cmVPcGVuQUlBcGlJbnN0YW5jZU5hbWU6IFwiYXp1cmVfb3BlbmFpX2FwaV9pbnN0YW5jZV9uYW1lXCIsXG4gICAgICAgICAgICBhenVyZU9wZW5BSUFwaURlcGxveW1lbnROYW1lOiBcImF6dXJlX29wZW5haV9hcGlfZGVwbG95bWVudF9uYW1lXCIsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGZpZWxkcywgXG4gICAgLyoqIEBkZXByZWNhdGVkICovXG4gICAgY29uZmlndXJhdGlvbikge1xuICAgICAgICBzdXBlcihmaWVsZHMgPz8ge30pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJsY19zZXJpYWxpemFibGVcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInRlbXBlcmF0dXJlXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiAxXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJ0b3BQXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiAxXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJmcmVxdWVuY3lQZW5hbHR5XCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJwcmVzZW5jZVBlbmFsdHlcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IDFcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImxvZ2l0Qmlhc1wiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJtb2RlbE5hbWVcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiZ3B0LTMuNS10dXJib1wiXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJtb2RlbEt3YXJnc1wiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJzdG9wXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInRpbWVvdXRcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwic3RyZWFtaW5nXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWF4VG9rZW5zXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImF6dXJlT3BlbkFJQXBpVmVyc2lvblwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJhenVyZU9wZW5BSUFwaUtleVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJhenVyZU9wZW5BSUFwaUluc3RhbmNlTmFtZVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJhenVyZU9wZW5BSUFwaURlcGxveW1lbnROYW1lXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImNsaWVudFwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJjbGllbnRDb25maWdcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgYXBpS2V5ID0gZmllbGRzPy5vcGVuQUlBcGlLZXkgPz8gZ2V0RW52aXJvbm1lbnRWYXJpYWJsZShcIk9QRU5BSV9BUElfS0VZXCIpO1xuICAgICAgICBjb25zdCBhenVyZUFwaUtleSA9IGZpZWxkcz8uYXp1cmVPcGVuQUlBcGlLZXkgPz9cbiAgICAgICAgICAgIGdldEVudmlyb25tZW50VmFyaWFibGUoXCJBWlVSRV9PUEVOQUlfQVBJX0tFWVwiKTtcbiAgICAgICAgaWYgKCFhenVyZUFwaUtleSAmJiAhYXBpS2V5KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCIoQXp1cmUpIE9wZW5BSSBBUEkga2V5IG5vdCBmb3VuZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhenVyZUFwaUluc3RhbmNlTmFtZSA9IGZpZWxkcz8uYXp1cmVPcGVuQUlBcGlJbnN0YW5jZU5hbWUgPz9cbiAgICAgICAgICAgIGdldEVudmlyb25tZW50VmFyaWFibGUoXCJBWlVSRV9PUEVOQUlfQVBJX0lOU1RBTkNFX05BTUVcIik7XG4gICAgICAgIGNvbnN0IGF6dXJlQXBpRGVwbG95bWVudE5hbWUgPSBmaWVsZHM/LmF6dXJlT3BlbkFJQXBpRGVwbG95bWVudE5hbWUgPz9cbiAgICAgICAgICAgIGdldEVudmlyb25tZW50VmFyaWFibGUoXCJBWlVSRV9PUEVOQUlfQVBJX0RFUExPWU1FTlRfTkFNRVwiKTtcbiAgICAgICAgY29uc3QgYXp1cmVBcGlWZXJzaW9uID0gZmllbGRzPy5henVyZU9wZW5BSUFwaVZlcnNpb24gPz9cbiAgICAgICAgICAgIGdldEVudmlyb25tZW50VmFyaWFibGUoXCJBWlVSRV9PUEVOQUlfQVBJX1ZFUlNJT05cIik7XG4gICAgICAgIHRoaXMubW9kZWxOYW1lID0gZmllbGRzPy5tb2RlbE5hbWUgPz8gdGhpcy5tb2RlbE5hbWU7XG4gICAgICAgIHRoaXMubW9kZWxLd2FyZ3MgPSBmaWVsZHM/Lm1vZGVsS3dhcmdzID8/IHt9O1xuICAgICAgICB0aGlzLnRpbWVvdXQgPSBmaWVsZHM/LnRpbWVvdXQ7XG4gICAgICAgIHRoaXMudGVtcGVyYXR1cmUgPSBmaWVsZHM/LnRlbXBlcmF0dXJlID8/IHRoaXMudGVtcGVyYXR1cmU7XG4gICAgICAgIHRoaXMudG9wUCA9IGZpZWxkcz8udG9wUCA/PyB0aGlzLnRvcFA7XG4gICAgICAgIHRoaXMuZnJlcXVlbmN5UGVuYWx0eSA9IGZpZWxkcz8uZnJlcXVlbmN5UGVuYWx0eSA/PyB0aGlzLmZyZXF1ZW5jeVBlbmFsdHk7XG4gICAgICAgIHRoaXMucHJlc2VuY2VQZW5hbHR5ID0gZmllbGRzPy5wcmVzZW5jZVBlbmFsdHkgPz8gdGhpcy5wcmVzZW5jZVBlbmFsdHk7XG4gICAgICAgIHRoaXMubWF4VG9rZW5zID0gZmllbGRzPy5tYXhUb2tlbnM7XG4gICAgICAgIHRoaXMubiA9IGZpZWxkcz8ubiA/PyB0aGlzLm47XG4gICAgICAgIHRoaXMubG9naXRCaWFzID0gZmllbGRzPy5sb2dpdEJpYXM7XG4gICAgICAgIHRoaXMuc3RvcCA9IGZpZWxkcz8uc3RvcDtcbiAgICAgICAgdGhpcy5zdHJlYW1pbmcgPSBmaWVsZHM/LnN0cmVhbWluZyA/PyBmYWxzZTtcbiAgICAgICAgdGhpcy5henVyZU9wZW5BSUFwaVZlcnNpb24gPSBhenVyZUFwaVZlcnNpb247XG4gICAgICAgIHRoaXMuYXp1cmVPcGVuQUlBcGlLZXkgPSBhenVyZUFwaUtleTtcbiAgICAgICAgdGhpcy5henVyZU9wZW5BSUFwaUluc3RhbmNlTmFtZSA9IGF6dXJlQXBpSW5zdGFuY2VOYW1lO1xuICAgICAgICB0aGlzLmF6dXJlT3BlbkFJQXBpRGVwbG95bWVudE5hbWUgPSBhenVyZUFwaURlcGxveW1lbnROYW1lO1xuICAgICAgICBpZiAodGhpcy5zdHJlYW1pbmcgJiYgdGhpcy5uID4gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHN0cmVhbSByZXN1bHRzIHdoZW4gbiA+IDFcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYXp1cmVPcGVuQUlBcGlLZXkpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5henVyZU9wZW5BSUFwaUluc3RhbmNlTmFtZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkF6dXJlIE9wZW5BSSBBUEkgaW5zdGFuY2UgbmFtZSBub3QgZm91bmRcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuYXp1cmVPcGVuQUlBcGlEZXBsb3ltZW50TmFtZSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkF6dXJlIE9wZW5BSSBBUEkgZGVwbG95bWVudCBuYW1lIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5henVyZU9wZW5BSUFwaVZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBenVyZSBPcGVuQUkgQVBJIHZlcnNpb24gbm90IGZvdW5kXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xpZW50Q29uZmlnID0ge1xuICAgICAgICAgICAgYXBpS2V5LFxuICAgICAgICAgICAgLi4uY29uZmlndXJhdGlvbixcbiAgICAgICAgICAgIC4uLmZpZWxkcz8uY29uZmlndXJhdGlvbixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBwYXJhbWV0ZXJzIHVzZWQgdG8gaW52b2tlIHRoZSBtb2RlbFxuICAgICAqL1xuICAgIGludm9jYXRpb25QYXJhbXMoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbE5hbWUsXG4gICAgICAgICAgICB0ZW1wZXJhdHVyZTogdGhpcy50ZW1wZXJhdHVyZSxcbiAgICAgICAgICAgIHRvcF9wOiB0aGlzLnRvcFAsXG4gICAgICAgICAgICBmcmVxdWVuY3lfcGVuYWx0eTogdGhpcy5mcmVxdWVuY3lQZW5hbHR5LFxuICAgICAgICAgICAgcHJlc2VuY2VfcGVuYWx0eTogdGhpcy5wcmVzZW5jZVBlbmFsdHksXG4gICAgICAgICAgICBtYXhfdG9rZW5zOiB0aGlzLm1heFRva2VucyA9PT0gLTEgPyB1bmRlZmluZWQgOiB0aGlzLm1heFRva2VucyxcbiAgICAgICAgICAgIG46IHRoaXMubixcbiAgICAgICAgICAgIGxvZ2l0X2JpYXM6IHRoaXMubG9naXRCaWFzLFxuICAgICAgICAgICAgc3RvcDogdGhpcy5zdG9wLFxuICAgICAgICAgICAgc3RyZWFtOiB0aGlzLnN0cmVhbWluZyxcbiAgICAgICAgICAgIC4uLnRoaXMubW9kZWxLd2FyZ3MsXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKiBAaWdub3JlICovXG4gICAgX2lkZW50aWZ5aW5nUGFyYW1zKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbW9kZWxfbmFtZTogdGhpcy5tb2RlbE5hbWUsXG4gICAgICAgICAgICAuLi50aGlzLmludm9jYXRpb25QYXJhbXMoKSxcbiAgICAgICAgICAgIC4uLnRoaXMuY2xpZW50Q29uZmlnLFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGlkZW50aWZ5aW5nIHBhcmFtZXRlcnMgZm9yIHRoZSBtb2RlbFxuICAgICAqL1xuICAgIGlkZW50aWZ5aW5nUGFyYW1zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faWRlbnRpZnlpbmdQYXJhbXMoKTtcbiAgICB9XG4gICAgLyoqIEBpZ25vcmUgKi9cbiAgICBhc3luYyBfZ2VuZXJhdGUobWVzc2FnZXMsIG9wdGlvbnMsIHJ1bk1hbmFnZXIpIHtcbiAgICAgICAgY29uc3QgdG9rZW5Vc2FnZSA9IHt9O1xuICAgICAgICBpZiAodGhpcy5zdG9wICYmIG9wdGlvbnM/LnN0b3ApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN0b3AgZm91bmQgaW4gaW5wdXQgYW5kIGRlZmF1bHQgcGFyYW1zXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMuaW52b2NhdGlvblBhcmFtcygpO1xuICAgICAgICBwYXJhbXMuc3RvcCA9IG9wdGlvbnM/LnN0b3AgPz8gcGFyYW1zLnN0b3A7XG4gICAgICAgIHBhcmFtcy5mdW5jdGlvbnMgPVxuICAgICAgICAgICAgb3B0aW9ucz8uZnVuY3Rpb25zID8/XG4gICAgICAgICAgICAgICAgKG9wdGlvbnM/LnRvb2xzID8gb3B0aW9ucz8udG9vbHMubWFwKGZvcm1hdFRvT3BlbkFJRnVuY3Rpb24pIDogdW5kZWZpbmVkKTtcbiAgICAgICAgcGFyYW1zLmZ1bmN0aW9uX2NhbGwgPSBvcHRpb25zPy5mdW5jdGlvbl9jYWxsO1xuICAgICAgICBjb25zdCBtZXNzYWdlc01hcHBlZCA9IG1lc3NhZ2VzLm1hcCgobWVzc2FnZSkgPT4gKHtcbiAgICAgICAgICAgIHJvbGU6IG1lc3NhZ2VUeXBlVG9PcGVuQUlSb2xlKG1lc3NhZ2UuX2dldFR5cGUoKSksXG4gICAgICAgICAgICBjb250ZW50OiBtZXNzYWdlLnRleHQsXG4gICAgICAgICAgICBuYW1lOiBtZXNzYWdlLm5hbWUsXG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgZGF0YSA9IHBhcmFtcy5zdHJlYW1cbiAgICAgICAgICAgID8gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCByZXNwb25zZTtcbiAgICAgICAgICAgICAgICBsZXQgcmVqZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBsZXQgcmVzb2x2ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbXBsZXRpb25XaXRoUmV0cnkoe1xuICAgICAgICAgICAgICAgICAgICAuLi5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlc01hcHBlZCxcbiAgICAgICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgICAgIHNpZ25hbDogb3B0aW9ucz8uc2lnbmFsLFxuICAgICAgICAgICAgICAgICAgICAuLi5vcHRpb25zPy5vcHRpb25zLFxuICAgICAgICAgICAgICAgICAgICBhZGFwdGVyOiBmZXRjaEFkYXB0ZXIsXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogXCJzdHJlYW1cIixcbiAgICAgICAgICAgICAgICAgICAgb25tZXNzYWdlOiAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5kYXRhPy50cmltPy4oKSA9PT0gXCJbRE9ORV1cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNvbHZlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBKU09OLnBhcnNlKGV2ZW50LmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9uIHRoZSBmaXJzdCBtZXNzYWdlIHNldCB0aGUgcmVzcG9uc2UgcHJvcGVydGllc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbWVzc2FnZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdDogbWVzc2FnZS5vYmplY3QsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkOiBtZXNzYWdlLmNyZWF0ZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbDogbWVzc2FnZS5tb2RlbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZXM6IFtdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvbiBhbGwgbWVzc2FnZXMsIHVwZGF0ZSBjaG9pY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHBhcnQgb2YgbWVzc2FnZS5jaG9pY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaG9pY2UgPSByZXNwb25zZS5jaG9pY2VzLmZpbmQoKGMpID0+IGMuaW5kZXggPT09IHBhcnQuaW5kZXgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjaG9pY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2UgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBwYXJ0LmluZGV4LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2hfcmVhc29uOiBwYXJ0LmZpbmlzaF9yZWFzb24gPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2hvaWNlc1twYXJ0LmluZGV4XSA9IGNob2ljZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghY2hvaWNlLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2UubWVzc2FnZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9sZTogcGFydC5kZWx0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPy5yb2xlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFydC5kZWx0YS5mdW5jdGlvbl9jYWxsICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWNob2ljZS5tZXNzYWdlLmZ1bmN0aW9uX2NhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2UubWVzc2FnZS5mdW5jdGlvbl9jYWxsID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZS5tZXNzYWdlLmNvbnRlbnQgKz0gcGFydC5kZWx0YT8uY29udGVudCA/PyBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNob2ljZS5tZXNzYWdlLmZ1bmN0aW9uX2NhbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9pY2UubWVzc2FnZS5mdW5jdGlvbl9jYWxsLm5hbWUgKz1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydC5kZWx0YT8uZnVuY3Rpb25fY2FsbD8ubmFtZSA/PyBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNob2ljZS5tZXNzYWdlLmZ1bmN0aW9uX2NhbGwuYXJndW1lbnRzICs9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQuZGVsdGE/LmZ1bmN0aW9uX2NhbGw/LmFyZ3VtZW50cyA/PyBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyB0aGlzIHNob3VsZCBwYXNzIHBhcnQuaW5kZXggdG8gdGhlIGNhbGxiYWNrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIHRoYXQncyBzdXBwb3J0ZWQgdGhlcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby12b2lkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2b2lkIHJ1bk1hbmFnZXI/LmhhbmRsZUxMTU5ld1Rva2VuKHBhcnQuZGVsdGE/LmNvbnRlbnQgPz8gXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIHdlIGRvbid0IGN1cnJlbnRseSBoYXZlIGEgY2FsbGJhY2sgbWV0aG9kIGZvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VuZGluZyB0aGUgZnVuY3Rpb24gY2FsbCBhcmd1bWVudHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIGFsbCBtZXNzYWdlcyBhcmUgZmluaXNoZWQsIHJlc29sdmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc29sdmVkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuY2hvaWNlcy5ldmVyeSgoYykgPT4gYy5maW5pc2hfcmVhc29uICE9IG51bGwpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlamVjdGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgOiBhd2FpdCB0aGlzLmNvbXBsZXRpb25XaXRoUmV0cnkoe1xuICAgICAgICAgICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlczogbWVzc2FnZXNNYXBwZWQsXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgc2lnbmFsOiBvcHRpb25zPy5zaWduYWwsXG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucz8ub3B0aW9ucyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBjb25zdCB7IGNvbXBsZXRpb25fdG9rZW5zOiBjb21wbGV0aW9uVG9rZW5zLCBwcm9tcHRfdG9rZW5zOiBwcm9tcHRUb2tlbnMsIHRvdGFsX3Rva2VuczogdG90YWxUb2tlbnMsIH0gPSBkYXRhLnVzYWdlID8/IHt9O1xuICAgICAgICBpZiAoY29tcGxldGlvblRva2Vucykge1xuICAgICAgICAgICAgdG9rZW5Vc2FnZS5jb21wbGV0aW9uVG9rZW5zID1cbiAgICAgICAgICAgICAgICAodG9rZW5Vc2FnZS5jb21wbGV0aW9uVG9rZW5zID8/IDApICsgY29tcGxldGlvblRva2VucztcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvbXB0VG9rZW5zKSB7XG4gICAgICAgICAgICB0b2tlblVzYWdlLnByb21wdFRva2VucyA9ICh0b2tlblVzYWdlLnByb21wdFRva2VucyA/PyAwKSArIHByb21wdFRva2VucztcbiAgICAgICAgfVxuICAgICAgICBpZiAodG90YWxUb2tlbnMpIHtcbiAgICAgICAgICAgIHRva2VuVXNhZ2UudG90YWxUb2tlbnMgPSAodG9rZW5Vc2FnZS50b3RhbFRva2VucyA/PyAwKSArIHRvdGFsVG9rZW5zO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdlbmVyYXRpb25zID0gW107XG4gICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBkYXRhLmNob2ljZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBwYXJ0Lm1lc3NhZ2U/LmNvbnRlbnQgPz8gXCJcIjtcbiAgICAgICAgICAgIGdlbmVyYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogb3BlbkFJUmVzcG9uc2VUb0NoYXRNZXNzYWdlKHBhcnQubWVzc2FnZSA/PyB7IHJvbGU6IFwiYXNzaXN0YW50XCIgfSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2VuZXJhdGlvbnMsXG4gICAgICAgICAgICBsbG1PdXRwdXQ6IHsgdG9rZW5Vc2FnZSB9LFxuICAgICAgICB9O1xuICAgIH1cbiAgICBhc3luYyBnZXROdW1Ub2tlbnNGcm9tTWVzc2FnZXMobWVzc2FnZXMpIHtcbiAgICAgICAgbGV0IHRvdGFsQ291bnQgPSAwO1xuICAgICAgICBsZXQgdG9rZW5zUGVyTWVzc2FnZSA9IDA7XG4gICAgICAgIGxldCB0b2tlbnNQZXJOYW1lID0gMDtcbiAgICAgICAgLy8gRnJvbTogaHR0cHM6Ly9naXRodWIuY29tL29wZW5haS9vcGVuYWktY29va2Jvb2svYmxvYi9tYWluL2V4YW1wbGVzL0hvd190b19mb3JtYXRfaW5wdXRzX3RvX0NoYXRHUFRfbW9kZWxzLmlweW5iXG4gICAgICAgIGlmIChnZXRNb2RlbE5hbWVGb3JUaWt0b2tlbih0aGlzLm1vZGVsTmFtZSkgPT09IFwiZ3B0LTMuNS10dXJib1wiKSB7XG4gICAgICAgICAgICB0b2tlbnNQZXJNZXNzYWdlID0gNDtcbiAgICAgICAgICAgIHRva2Vuc1Blck5hbWUgPSAtMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChnZXRNb2RlbE5hbWVGb3JUaWt0b2tlbih0aGlzLm1vZGVsTmFtZSkuc3RhcnRzV2l0aChcImdwdC00XCIpKSB7XG4gICAgICAgICAgICB0b2tlbnNQZXJNZXNzYWdlID0gMztcbiAgICAgICAgICAgIHRva2Vuc1Blck5hbWUgPSAxO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvdW50UGVyTWVzc2FnZSA9IGF3YWl0IFByb21pc2UuYWxsKG1lc3NhZ2VzLm1hcChhc3luYyAobWVzc2FnZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGV4dENvdW50ID0gYXdhaXQgdGhpcy5nZXROdW1Ub2tlbnMobWVzc2FnZS50ZXh0KTtcbiAgICAgICAgICAgIGNvbnN0IHJvbGVDb3VudCA9IGF3YWl0IHRoaXMuZ2V0TnVtVG9rZW5zKG1lc3NhZ2VUeXBlVG9PcGVuQUlSb2xlKG1lc3NhZ2UuX2dldFR5cGUoKSkpO1xuICAgICAgICAgICAgY29uc3QgbmFtZUNvdW50ID0gbWVzc2FnZS5uYW1lICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICA/IHRva2Vuc1Blck5hbWUgKyAoYXdhaXQgdGhpcy5nZXROdW1Ub2tlbnMobWVzc2FnZS5uYW1lKSlcbiAgICAgICAgICAgICAgICA6IDA7XG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IHRleHRDb3VudCArIHRva2Vuc1Blck1lc3NhZ2UgKyByb2xlQ291bnQgKyBuYW1lQ291bnQ7XG4gICAgICAgICAgICB0b3RhbENvdW50ICs9IGNvdW50O1xuICAgICAgICAgICAgcmV0dXJuIGNvdW50O1xuICAgICAgICB9KSk7XG4gICAgICAgIHRvdGFsQ291bnQgKz0gMzsgLy8gZXZlcnkgcmVwbHkgaXMgcHJpbWVkIHdpdGggPHxzdGFydHw+YXNzaXN0YW50PHxtZXNzYWdlfD5cbiAgICAgICAgcmV0dXJuIHsgdG90YWxDb3VudCwgY291bnRQZXJNZXNzYWdlIH07XG4gICAgfVxuICAgIC8qKiBAaWdub3JlICovXG4gICAgYXN5bmMgY29tcGxldGlvbldpdGhSZXRyeShyZXF1ZXN0LCBvcHRpb25zKSB7XG4gICAgICAgIGlmICghdGhpcy5jbGllbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGVuZHBvaW50ID0gdGhpcy5henVyZU9wZW5BSUFwaUtleVxuICAgICAgICAgICAgICAgID8gYGh0dHBzOi8vJHt0aGlzLmF6dXJlT3BlbkFJQXBpSW5zdGFuY2VOYW1lfS5vcGVuYWkuYXp1cmUuY29tL29wZW5haS9kZXBsb3ltZW50cy8ke3RoaXMuYXp1cmVPcGVuQUlBcGlEZXBsb3ltZW50TmFtZX1gXG4gICAgICAgICAgICAgICAgOiB0aGlzLmNsaWVudENvbmZpZy5iYXNlUGF0aDtcbiAgICAgICAgICAgIGNvbnN0IGNsaWVudENvbmZpZyA9IG5ldyBDb25maWd1cmF0aW9uKHtcbiAgICAgICAgICAgICAgICAuLi50aGlzLmNsaWVudENvbmZpZyxcbiAgICAgICAgICAgICAgICBiYXNlUGF0aDogZW5kcG9pbnQsXG4gICAgICAgICAgICAgICAgYmFzZU9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogdGhpcy50aW1lb3V0LFxuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmNsaWVudENvbmZpZy5iYXNlT3B0aW9ucyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmNsaWVudCA9IG5ldyBPcGVuQUlBcGkoY2xpZW50Q29uZmlnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBheGlvc09wdGlvbnMgPSB7XG4gICAgICAgICAgICBhZGFwdGVyOiBpc05vZGUoKSA/IHVuZGVmaW5lZCA6IGZldGNoQWRhcHRlcixcbiAgICAgICAgICAgIC4uLnRoaXMuY2xpZW50Q29uZmlnLmJhc2VPcHRpb25zLFxuICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuYXp1cmVPcGVuQUlBcGlLZXkpIHtcbiAgICAgICAgICAgIGF4aW9zT3B0aW9ucy5oZWFkZXJzID0ge1xuICAgICAgICAgICAgICAgIFwiYXBpLWtleVwiOiB0aGlzLmF6dXJlT3BlbkFJQXBpS2V5LFxuICAgICAgICAgICAgICAgIC4uLmF4aW9zT3B0aW9ucy5oZWFkZXJzLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGF4aW9zT3B0aW9ucy5wYXJhbXMgPSB7XG4gICAgICAgICAgICAgICAgXCJhcGktdmVyc2lvblwiOiB0aGlzLmF6dXJlT3BlbkFJQXBpVmVyc2lvbixcbiAgICAgICAgICAgICAgICAuLi5heGlvc09wdGlvbnMucGFyYW1zLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jYWxsZXJcbiAgICAgICAgICAgIC5jYWxsKHRoaXMuY2xpZW50LmNyZWF0ZUNoYXRDb21wbGV0aW9uLmJpbmQodGhpcy5jbGllbnQpLCByZXF1ZXN0LCBheGlvc09wdGlvbnMpXG4gICAgICAgICAgICAudGhlbigocmVzKSA9PiByZXMuZGF0YSk7XG4gICAgfVxuICAgIF9sbG1UeXBlKCkge1xuICAgICAgICByZXR1cm4gXCJvcGVuYWlcIjtcbiAgICB9XG4gICAgLyoqIEBpZ25vcmUgKi9cbiAgICBfY29tYmluZUxMTU91dHB1dCguLi5sbG1PdXRwdXRzKSB7XG4gICAgICAgIHJldHVybiBsbG1PdXRwdXRzLnJlZHVjZSgoYWNjLCBsbG1PdXRwdXQpID0+IHtcbiAgICAgICAgICAgIGlmIChsbG1PdXRwdXQgJiYgbGxtT3V0cHV0LnRva2VuVXNhZ2UpIHtcbiAgICAgICAgICAgICAgICBhY2MudG9rZW5Vc2FnZS5jb21wbGV0aW9uVG9rZW5zICs9XG4gICAgICAgICAgICAgICAgICAgIGxsbU91dHB1dC50b2tlblVzYWdlLmNvbXBsZXRpb25Ub2tlbnMgPz8gMDtcbiAgICAgICAgICAgICAgICBhY2MudG9rZW5Vc2FnZS5wcm9tcHRUb2tlbnMgKz0gbGxtT3V0cHV0LnRva2VuVXNhZ2UucHJvbXB0VG9rZW5zID8/IDA7XG4gICAgICAgICAgICAgICAgYWNjLnRva2VuVXNhZ2UudG90YWxUb2tlbnMgKz0gbGxtT3V0cHV0LnRva2VuVXNhZ2UudG90YWxUb2tlbnMgPz8gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHRva2VuVXNhZ2U6IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0aW9uVG9rZW5zOiAwLFxuICAgICAgICAgICAgICAgIHByb21wdFRva2VuczogMCxcbiAgICAgICAgICAgICAgICB0b3RhbFRva2VuczogMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBQcm9tcHRMYXllckNoYXRPcGVuQUkgZXh0ZW5kcyBDaGF0T3BlbkFJIHtcbiAgICBjb25zdHJ1Y3RvcihmaWVsZHMpIHtcbiAgICAgICAgc3VwZXIoZmllbGRzKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicHJvbXB0TGF5ZXJBcGlLZXlcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicGxUYWdzXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJldHVyblByb21wdExheWVySWRcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wcm9tcHRMYXllckFwaUtleSA9XG4gICAgICAgICAgICBmaWVsZHM/LnByb21wdExheWVyQXBpS2V5ID8/XG4gICAgICAgICAgICAgICAgKHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiXG4gICAgICAgICAgICAgICAgICAgID8gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXByb2Nlc3MtZW52XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudj8uUFJPTVBUTEFZRVJfQVBJX0tFWVxuICAgICAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCk7XG4gICAgICAgIHRoaXMucGxUYWdzID0gZmllbGRzPy5wbFRhZ3MgPz8gW107XG4gICAgICAgIHRoaXMucmV0dXJuUHJvbXB0TGF5ZXJJZCA9IGZpZWxkcz8ucmV0dXJuUHJvbXB0TGF5ZXJJZCA/PyBmYWxzZTtcbiAgICB9XG4gICAgYXN5bmMgX2dlbmVyYXRlKG1lc3NhZ2VzLCBvcHRpb25zLCBydW5NYW5hZ2VyKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RTdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBsZXQgcGFyc2VkT3B0aW9ucztcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9ucykpIHtcbiAgICAgICAgICAgIHBhcnNlZE9wdGlvbnMgPSB7IHN0b3A6IG9wdGlvbnMgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvcHRpb25zPy50aW1lb3V0ICYmICFvcHRpb25zLnNpZ25hbCkge1xuICAgICAgICAgICAgcGFyc2VkT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgICAgIHNpZ25hbDogQWJvcnRTaWduYWwudGltZW91dChvcHRpb25zLnRpbWVvdXQpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHBhcnNlZE9wdGlvbnMgPSBvcHRpb25zID8/IHt9O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGdlbmVyYXRlZFJlc3BvbnNlcyA9IGF3YWl0IHN1cGVyLl9nZW5lcmF0ZShtZXNzYWdlcywgcGFyc2VkT3B0aW9ucywgcnVuTWFuYWdlcik7XG4gICAgICAgIGNvbnN0IHJlcXVlc3RFbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgY29uc3QgX2NvbnZlcnRNZXNzYWdlVG9EaWN0ID0gKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICBsZXQgbWVzc2FnZURpY3Q7XG4gICAgICAgICAgICBpZiAobWVzc2FnZS5fZ2V0VHlwZSgpID09PSBcImh1bWFuXCIpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlRGljdCA9IHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IG1lc3NhZ2UudGV4dCB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAobWVzc2FnZS5fZ2V0VHlwZSgpID09PSBcImFpXCIpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlRGljdCA9IHsgcm9sZTogXCJhc3Npc3RhbnRcIiwgY29udGVudDogbWVzc2FnZS50ZXh0IH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtZXNzYWdlLl9nZXRUeXBlKCkgPT09IFwic3lzdGVtXCIpIHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlRGljdCA9IHsgcm9sZTogXCJzeXN0ZW1cIiwgY29udGVudDogbWVzc2FnZS50ZXh0IH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChtZXNzYWdlLl9nZXRUeXBlKCkgPT09IFwiZ2VuZXJpY1wiKSB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZURpY3QgPSB7XG4gICAgICAgICAgICAgICAgICAgIHJvbGU6IG1lc3NhZ2Uucm9sZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogbWVzc2FnZS50ZXh0LFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEdvdCB1bmtub3duIHR5cGUgJHttZXNzYWdlfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VEaWN0O1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBfY3JlYXRlTWVzc2FnZURpY3RzID0gKG1lc3NhZ2VzLCBjYWxsT3B0aW9ucykgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgICAgICAgICAgIC4uLnRoaXMuaW52b2NhdGlvblBhcmFtcygpLFxuICAgICAgICAgICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsTmFtZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoY2FsbE9wdGlvbnM/LnN0b3ApIHtcbiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMocGFyYW1zKS5pbmNsdWRlcyhcInN0b3BcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiYHN0b3BgIGZvdW5kIGluIGJvdGggdGhlIGlucHV0IGFuZCBkZWZhdWx0IHBhcmFtcy5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZURpY3RzID0gbWVzc2FnZXMubWFwKChtZXNzYWdlKSA9PiBfY29udmVydE1lc3NhZ2VUb0RpY3QobWVzc2FnZSkpO1xuICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VEaWN0cztcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnZW5lcmF0ZWRSZXNwb25zZXMuZ2VuZXJhdGlvbnMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSBnZW5lcmF0ZWRSZXNwb25zZXMuZ2VuZXJhdGlvbnNbaV07XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlRGljdHMgPSBfY3JlYXRlTWVzc2FnZURpY3RzKG1lc3NhZ2VzLCBwYXJzZWRPcHRpb25zKTtcbiAgICAgICAgICAgIGxldCBwcm9tcHRMYXllclJlcXVlc3RJZDtcbiAgICAgICAgICAgIGNvbnN0IHBhcnNlZFJlc3AgPSBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBnZW5lcmF0aW9uLnRleHQsXG4gICAgICAgICAgICAgICAgICAgIHJvbGU6IG1lc3NhZ2VUeXBlVG9PcGVuQUlSb2xlKGdlbmVyYXRpb24ubWVzc2FnZS5fZ2V0VHlwZSgpKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGNvbnN0IHByb21wdExheWVyUmVzcEJvZHkgPSBhd2FpdCBwcm9tcHRMYXllclRyYWNrUmVxdWVzdCh0aGlzLmNhbGxlciwgXCJsYW5nY2hhaW4uUHJvbXB0TGF5ZXJDaGF0T3BlbkFJXCIsIG1lc3NhZ2VEaWN0cywgdGhpcy5faWRlbnRpZnlpbmdQYXJhbXMoKSwgdGhpcy5wbFRhZ3MsIHBhcnNlZFJlc3AsIHJlcXVlc3RTdGFydFRpbWUsIHJlcXVlc3RFbmRUaW1lLCB0aGlzLnByb21wdExheWVyQXBpS2V5KTtcbiAgICAgICAgICAgIGlmICh0aGlzLnJldHVyblByb21wdExheWVySWQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICBpZiAocHJvbXB0TGF5ZXJSZXNwQm9keS5zdWNjZXNzID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21wdExheWVyUmVxdWVzdElkID0gcHJvbXB0TGF5ZXJSZXNwQm9keS5yZXF1ZXN0X2lkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWdlbmVyYXRpb24uZ2VuZXJhdGlvbkluZm8gfHxcbiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGdlbmVyYXRpb24uZ2VuZXJhdGlvbkluZm8gIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGlvbi5nZW5lcmF0aW9uSW5mbyA9IHt9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBnZW5lcmF0aW9uLmdlbmVyYXRpb25JbmZvLnByb21wdExheWVyUmVxdWVzdElkID0gcHJvbXB0TGF5ZXJSZXF1ZXN0SWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdlbmVyYXRlZFJlc3BvbnNlcztcbiAgICB9XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./node_modules/langchain/dist/chat_models/openai.js\n"));

/***/ }),

/***/ "./node_modules/langchain/dist/tools/convert_to_openai.js":
/*!****************************************************************!*\
  !*** ./node_modules/langchain/dist/tools/convert_to_openai.js ***!
  \****************************************************************/
/***/ (function(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"formatToOpenAIFunction\": function() { return /* binding */ formatToOpenAIFunction; }\n/* harmony export */ });\n/* harmony import */ var zod_to_json_schema__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod-to-json-schema */ \"./node_modules/zod-to-json-schema/index.js\");\n\nfunction formatToOpenAIFunction(tool) {\n    return {\n        name: tool.name,\n        description: tool.description,\n        parameters: (0,zod_to_json_schema__WEBPACK_IMPORTED_MODULE_0__.zodToJsonSchema)(tool.schema),\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbGFuZ2NoYWluL2Rpc3QvdG9vbHMvY29udmVydF90b19vcGVuYWkuanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBcUQ7QUFDOUM7QUFDUDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsbUVBQWU7QUFDbkM7QUFDQSIsInNvdXJjZXMiOlsid2VicGFjazovL19OX0UvLi9ub2RlX21vZHVsZXMvbGFuZ2NoYWluL2Rpc3QvdG9vbHMvY29udmVydF90b19vcGVuYWkuanM/Mjc3YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB6b2RUb0pzb25TY2hlbWEgfSBmcm9tIFwiem9kLXRvLWpzb24tc2NoZW1hXCI7XG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0VG9PcGVuQUlGdW5jdGlvbih0b29sKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogdG9vbC5uYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbjogdG9vbC5kZXNjcmlwdGlvbixcbiAgICAgICAgcGFyYW1ldGVyczogem9kVG9Kc29uU2NoZW1hKHRvb2wuc2NoZW1hKSxcbiAgICB9O1xufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/langchain/dist/tools/convert_to_openai.js\n"));

/***/ })

}]);